<local:DraggableWidget x:Class="StudyDashboard.AudioVisualizerWidget"
                        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                        xmlns:local="clr-namespace:StudyDashboard">
    
    <Border Style="{StaticResource WidgetStyle}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            
            <TextBlock Grid.Row="0" Text="Sound Visualizer" Style="{StaticResource HeaderTextStyle}" Margin="0,0,0,5"/>
            
            <!-- スペクトラム表示エリア -->
            <Canvas x:Name="SpectrumCanvas" Grid.Row="1" Background="Transparent" MinHeight="80" Margin="0,0,0,5"/>
            
            <!-- 分析情報ステータス -->
            <Border x:Name="StatusBorder" Grid.Row="2" Background="#20FFFFFF" CornerRadius="4" Padding="6" Margin="0,5,0,0">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                        <TextBlock x:Name="DbText" Text="-∞ dB" FontSize="11" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center"/>
                        <TextBlock x:Name="DbLabel" Text="Level" FontSize="9" Foreground="#AAFFFFFF" HorizontalAlignment="Center"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                        <TextBlock x:Name="PeakFreqText" Text="-- Hz" FontSize="11" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center"/>
                        <TextBlock x:Name="PeakFreqLabel" Text="Peak Freq" FontSize="9" Foreground="#AAFFFFFF" HorizontalAlignment="Center"/>
                    </StackPanel>
                    
                    <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                        <TextBlock x:Name="FreqRangeText" Text="20-20k Hz" FontSize="11" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center"/>
                        <TextBlock x:Name="FreqRangeLabel" Text="Range" FontSize="9" Foreground="#AAFFFFFF" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Grid>
            </Border>
            
            <!-- コントロール -->
            <StackPanel Grid.Row="3" Margin="0,5,0,0">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <TextBlock Grid.Column="0" Text="Sens" Style="{StaticResource ContentTextStyle}" VerticalAlignment="Center" Margin="0,0,8,0" FontSize="11"/>
                    <Slider Grid.Column="1" x:Name="SensitivitySlider" Minimum="50" Maximum="800" Value="300" 
                           VerticalAlignment="Center" ValueChanged="SensitivitySlider_ValueChanged"/>
                    
                    <TextBlock Grid.Column="2" Text="Vol" Style="{StaticResource ContentTextStyle}" VerticalAlignment="Center" Margin="15,0,8,0" FontSize="11"/>
                    <Slider Grid.Column="3" x:Name="MasterVolumeSlider" Minimum="0" Maximum="100" Value="50" 
                           VerticalAlignment="Center" ValueChanged="MasterVolumeSlider_ValueChanged"/>
                </Grid>
                
                <!-- 音声出力先選択 -->
                <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                    <TextBlock Text="Output:" Style="{StaticResource ContentTextStyle}" VerticalAlignment="Center" Margin="0,0,8,0" FontSize="11"/>
                    <ComboBox x:Name="DeviceComboBox" Width="220" Background="#40FFFFFF" Foreground="Black" FontSize="11"
                             SelectionChanged="DeviceComboBox_SelectionChanged"/>
                    <TextBlock x:Name="MasterVolumeText" Text="50%" Style="{StaticResource ContentTextStyle}"
                              VerticalAlignment="Center" Margin="10,0,0,0" FontSize="11"/>
                </StackPanel>
                
                <TextBlock x:Name="DeviceInfoText" 
                          Text="Device: Default Audio Device"
                          Style="{StaticResource ContentTextStyle}" 
                          FontSize="10" Margin="0,3,0,0" Opacity="0.7"/>
            </StackPanel>
        </Grid>
    </Border>
</local:DraggableWidget>
